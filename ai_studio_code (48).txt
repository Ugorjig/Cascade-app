import React from 'react';
import type { Post as PostType, User, Product, Community, Comment, AdCampaign } from '../types.ts';
// FIX: Changed default import of 'Post' to a named import.
import { Post } from './Post.tsx';
import CommentComponent from './Comment.tsx';
import CreateComment from './CreateComment.tsx';

interface PostDetailPageProps {
  post: PostType;
  currentUser: User;
  subscribedToUserIds: string[];
  onBack: () => void;
  onCreateComment: (postId: string, content: string) => void;
  commentInitialText?: string;
  activeAdCampaigns: AdCampaign[];
  // Post interaction handlers
  handleToggleLike: (postId: string) => void;
  handleToggleEcho: (postId: string, isQuotePost?: boolean) => void;
  handleToggleBookmark: (postId: string) => void;
  handleSubscribe: (userId: string) => void;
  openGiftModal: (post: PostType) => void;
  handleAddToCart: (product: Product) => void;
  viewCommunity: (community: Community) => void;
  handleSearch: (query: string) => void;
  blockedUserIds: string[];
  handleToggleBlock: (userId: string) => void;
  handleViewPost: (post: PostType) => void;
  handleOpenQuoteModal: (post: PostType) => void;
  handleOpenEditModal: (post: PostType) => void;
  handleOpenBoostModal: (post: PostType) => void;
  handleViewProfile: (userId: string) => void;
  allUsers: User[];
  handlePlayVideo: (postId: string) => void;
  playingVideoId: string | null;
  handleShareToCommunity: (post: PostType) => void;
}

const PostDetailPage: React.FC<PostDetailPageProps> = (props) => {
  const { post, onBack, onCreateComment, currentUser, commentInitialText, activeAdCampaigns, ...rest } = props;

  const isBoosted = activeAdCampaigns.some(c => c.promotionType === 'post' && c.promotedPostId === post.id);

  return (
    <div className="fixed inset-0 bg-background dark:bg-dark-background z-50 flex flex-col animate-slide-up-full" role="dialog" aria-modal="true">
        <style>{`
          @keyframes slide-up-full {
              from { transform: translateY(100%); }
              to { transform: translateY(0); }
          }
          .animate-slide-up-full {
              animation: slide-up-full 0.3s ease-out forwards;
          }
        `}</style>
      
        <div className="sticky top-0 bg-background/80 dark:bg-dark-background/80 backdrop-blur-md z-10 px-4 py-3 flex items-center gap-4 border-b border-gray-200 dark:border-dark-border">
          <button onClick={onBack} className="text-on-surface dark:text-dark-on-surface p-2 rounded-full hover:bg-gray-100 dark:hover:bg-dark-surface">
            <svg viewBox="0 0 24 24" className="w-6 h-6" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></svg>
          </button>
          <h1 className="text-xl font-bold">Post</h1>
        </div>
        <div className="flex-1 overflow-y-auto">
          <Post 
              {...rest}
              post={post}
              currentUser={currentUser}
              isDetailView={true} 
              isBoosted={isBoosted}
              activeAdCampaigns={activeAdCampaigns}
          />
          {[...post.commentData].sort((a,b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime()).map(comment => (
              <CommentComponent key={comment.id} comment={comment} />
          ))}
        </div>
        <CreateComment 
          currentUser={currentUser} 
          onCreateComment={(content) => onCreateComment(post.id, content)} 
          initialText={commentInitialText}
          post={post}
        />
    </div>
  );
};

export default PostDetailPage;