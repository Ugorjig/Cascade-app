import React from 'react';
import type { Post as PostType, User, Product, Community, Comment } from '../types.ts';
import { Post } from './Post.tsx';
import CommentComponent from './Comment.tsx';
import CreateComment from './CreateComment.tsx';

interface PostDetailModalProps {
  post: PostType;
  currentUser: User;
  subscribedToUserIds: string[];
  onBack: () => void;
  onCreateComment: (postId: string, content: string) => void;
  // Post interaction handlers
  handleToggleLike: (postId: string) => void;
  handleToggleEcho: (postId: string, isQuotePost?: boolean) => void;
  handleToggleBookmark: (postId: string) => void;
  handleSubscribe: (userId: string) => void;
  openTipModal: (user: User) => void;
  openGiftModal: (post: PostType) => void;
  handleAddToCart: (product: Product) => void;
  claimedPostRewardIds: string[];
  handleClaimPostReward: (postId: string, reward: number) => void;
  viewCommunity: (community: Community) => void;
  handleSearch: (query: string) => void;
  blockedUserIds: string[];
  handleToggleBlock: (userId: string) => void;
  handleViewPost: (post: PostType) => void;
  handleOpenQuoteModal: (post: PostType) => void;
  handleOpenEditModal: (post: PostType) => void;
  handleViewProfile: (userId: string) => void;
  allUsers: User[];
  handlePlayVideo: (post: PostType) => void;
}

const PostDetailModal: React.FC<PostDetailModalProps> = (props) => {
  const { post, onBack, onCreateComment } = props;

  return (
    <div className="w-full border-x border-gray-200 dark:border-dark-border h-screen flex flex-col">
      <div className="sticky top-0 bg-background/80 dark:bg-dark-background/80 backdrop-blur-md z-10 px-4 py-3 flex items-center gap-4 border-b border-gray-200 dark:border-dark-border">
        <button onClick={onBack} className="text-on-surface dark:text-dark-on-surface">
          <svg viewBox="0 0 24 24" className="w-6 h-6" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></svg>
        </button>
        <h1 className="text-xl font-bold">Post</h1>
      </div>
      <div className="flex-1 overflow-y-auto">
        <Post {...props} post={post} isDetailView={true} />
        {post.commentData.sort((a,b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime()).map(comment => (
            <CommentComponent key={comment.id} comment={comment} />
        ))}
      </div>
      <CreateComment currentUser={props.currentUser} onCreateComment={(content) => onCreateComment(post.id, content)} post={post} />
    </div>
  );
};

export default PostDetailModal;